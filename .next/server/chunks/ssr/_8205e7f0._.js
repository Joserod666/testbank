module.exports=[58363,a=>{"use strict";function b(a){return new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}function c(a){let b=new Date;b.setHours(0,0,0,0);let c=new Date(a);return c.setHours(0,0,0,0),Math.ceil((c.getTime()-b.getTime())/864e5)}function d(a){let b=new Date;return Math.ceil((new Date(a).getTime()-b.getTime())/36e5)}function e(a){let b=d(a);if(c(a),b<0){let a=Math.abs(b),c=Math.floor(a/24);return`${c} d\xeda${1!==c?"s":""} y ${a%24} hora${a%24!=1?"s":""} atrasado`}if(b<24)return`${b} hora${1!==b?"s":""}`;let e=Math.floor(b/24),f=b%24;return 0===f?`${e} d\xeda${1!==e?"s":""}`:`${e} d\xeda${1!==e?"s":""} y ${f} hora${1!==f?"s":""}`}function f(a){let b=d(a);return b>=0&&b<=168}function g(a){let b=c(a);return b<0?"overdue":b<=3?"urgent":b<=7?"upcoming":"normal"}a.s(["formatDate",()=>b,"getDateStatus",()=>g,"getDaysUntil",()=>c,"getHoursUntil",()=>d,"getTimeUntilFormatted",()=>e,"isWithin7Days",()=>f])},84380,a=>{"use strict";var b=a.i(45618),c=a.i(58363);async function d(){let a=(0,b.createClient)("https://ixasfynswsdelghkbrgj.supabase.co","sb_publishable_VasDtu3o4SOb1McpLAHJkw_kCa8Ymtw"),{data:d}=await a.from("projects").select("*, clients(name, email)").in("status",["pending","in_progress","delayed"]).order("due_date",{ascending:!0});if(!d||0===d.length)return[];let e=[];return d.forEach(a=>{let b=(0,c.getHoursUntil)(a.due_date);b>=0&&b<=72&&e.push(a)}),e}async function e(b){let d=(0,c.getHoursUntil)(b.due_date),e=(0,c.getTimeUntilFormatted)(b.due_date),f=process.env.RESEND_API_KEY,g=process.env.RESEND_FROM_EMAIL||"noreply@example.com";if(!f)return console.warn("âš ï¸ RESEND_API_KEY no configurada. Saltando envÃ­o de email real."),{success:!1,error:"RESEND_API_KEY no configurada"};try{let h=await a.A(86473),i=h.Resend||h.default?.Resend||h.default;if(!i)throw Error("No se pudo importar Resend correctamente");let j=new i(f),k=`
			<h2>ðŸš¨ Alerta: Proyecto pr\xf3ximo a vencer</h2>
			<p>El siguiente proyecto est\xe1 pr\xf3ximo a vencer:</p>
			<ul>
				<li><strong>Proyecto:</strong> ${b.name}</li>
				<li><strong>Cliente:</strong> ${b.clients.name}</li>
				<li><strong>Fecha de vencimiento:</strong> ${(0,c.formatDate)(b.due_date)}</li>
				<li><strong>Tiempo restante:</strong> ${e}</li>
				<li><strong>Horas restantes:</strong> ${d} horas</li>
				<li><strong>Estado:</strong> ${b.status}</li>
				<li><strong>Progreso:</strong> ${b.completion_percentage}%</li>
			</ul>
			<p>Por favor, revisa el proyecto y toma las acciones necesarias.</p>
		`,l=b.clients.email||process.env.ALERT_DEFAULT_EMAIL||"admin@example.com",{data:m,error:n}=await j.emails.send({from:g,to:[l],subject:`ðŸš¨ Alerta: ${b.name} vence en ${e}`,html:k});if(n)return console.error("âŒ Error al enviar email:",n),{success:!1,error:n};return console.log("âœ… Email enviado exitosamente:",m),{success:!0,data:m}}catch(a){return console.error("âŒ Error al inicializar Resend:",a),{success:!1,error:a}}}async function f(){console.log("\nðŸ” Verificando proyectos prÃ³ximos a vencer...");let a=await d();if(0===a.length)return console.log("âœ… No hay proyectos prÃ³ximos a vencer (3 dÃ­as o menos)"),{count:0,alerts:[]};console.log(`âš ï¸ Se encontraron ${a.length} proyecto(s) pr\xf3ximo(s) a vencer
`);let b=[];for(let d of a){!function(a){let b=(0,c.getHoursUntil)(a.due_date),d=(0,c.getTimeUntilFormatted)(a.due_date);console.log("=".repeat(80)),console.log("ðŸš¨ ALERTA: Proyecto prÃ³ximo a vencer"),console.log("=".repeat(80)),console.log(`Proyecto: ${a.name}`),console.log(`Cliente: ${a.clients.name}`),console.log(`Fecha de vencimiento: ${(0,c.formatDate)(a.due_date)}`),console.log(`Tiempo restante: ${d}`),console.log(`Horas restantes: ${b} horas`),console.log(`Estado: ${a.status}`),console.log(`Progreso: ${a.completion_percentage}%`),console.log("=".repeat(80))}(d);let a=await e(d);b.push({project:d.name,console:!0,email:a.success,emailError:a.error})}return{count:a.length,alerts:b}}async function g(){try{return await f()}catch(a){return console.error("âŒ Error en deadline checker:",a),{count:0,alerts:[],error:a}}}function h(a=60){console.log(`â° Iniciando verificador de deadlines cada ${a} minutos`),g(),setInterval(()=>{g()},60*a*1e3)}a.s(["runDeadlineChecker",()=>g,"startDeadlineChecker",()=>h],84380)},86473,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[externals]_node:crypto_c20cce38._.js","server/chunks/ssr/node_modules_5637d8d0._.js"].map(b=>a.l(b))).then(()=>b(45069)))}];

//# sourceMappingURL=_8205e7f0._.js.map